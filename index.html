<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Simple PDF Viewer</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    
    <style>
        /* 기본 설정 */
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: #ffffff; /* 흰색 배경 */
            overflow: hidden; /* 전체 스크롤 막고 내부 컨테이너만 스크롤 */
        }

        /* 가로 스크롤 컨테이너 (핵심) */
        #viewer-container {
            display: flex;
            width: 100%;
            height: 100%;
            overflow-x: auto; /* 가로 스크롤 허용 */
            overflow-y: hidden;
            scroll-snap-type: x mandatory; /* 한 장씩 딱딱 걸리게 스냅 */
            -webkit-overflow-scrolling: touch; /* 모바일 부드러운 스크롤 */
        }

        /* 개별 페이지 스타일 */
        .page-wrapper {
            flex: 0 0 100%; /* 화면 꽉 차게 */
            width: 100%;
            height: 100%;
            scroll-snap-align: start; /* 스크롤 시 시작점에 맞춤 */
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: auto; /* 확대 시 내부 스크롤 허용 */
        }

        canvas {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* 비율 유지하며 화면에 맞춤 */
            display: block;
            /* 그림자 효과 (선택사항) */
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
        }

        /* 로딩 메시지 */
        #loader {
            position: absolute;
            top: 50%; left: 0; right: 0;
            transform: translateY(-50%);
            text-align: center;
            color: #333;
            font-size: 1.1rem;
            z-index: 100;
        }

        /* 페이지 번호 */
        #page-count {
            position: absolute;
            bottom: 20px;
            left: 0; right: 0;
            text-align: center;
            pointer-events: none;
            z-index: 200;
        }
        #page-count span {
            background: rgba(0, 0, 0, 0.6);
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div id="loader">문서 로딩 중...</div>
    
    <div id="page-count"><span>1 / --</span></div>

    <div id="viewer-container"></div>

    <script>
        // ==========================================
        var pdfUrl = 'a.pdf'; // 파일명 확인
        // ==========================================

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
        
        const container = document.getElementById('viewer-container');
        const loader = document.getElementById('loader');
        const pageCountBox = document.querySelector('#page-count span');

        async function loadPDF() {
            try {
                const loadingTask = pdfjsLib.getDocument(pdfUrl);
                const pdf = await loadingTask.promise;
                const totalPages = pdf.numPages;

                pageCountBox.innerText = `1 / ${totalPages}`;

                for (let i = 1; i <= totalPages; i++) {
                    const page = await pdf.getPage(i);
                    
                    // 3배 고해상도 (확대 시 깨짐 방지)
                    const viewport = page.getViewport({ scale: 3.0 });

                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;

                    // 캔버스 스타일 (화면에 맞춤)
                    // 중요: 여기서 width/height를 100%로 주지 않고 max로 제어해야 줌이 자연스러움
                    
                    await page.render({ canvasContext: ctx, viewport: viewport }).promise;

                    // 페이지 감싸는 div
                    const wrapper = document.createElement('div');
                    wrapper.className = 'page-wrapper';
                    
                    wrapper.appendChild(canvas);
                    container.appendChild(wrapper);
                }

                loader.style.display = 'none';

                // 스크롤 이벤트로 페이지 번호 감지
                container.addEventListener('scroll', () => {
                    const width = container.clientWidth;
                    // 현재 스크롤 위치를 너비로 나누어 페이지 계산
                    const currentPage = Math.round(container.scrollLeft / width) + 1;
                    pageCountBox.innerText = `${currentPage} / ${totalPages}`;
                });

            } catch (err) {
                loader.innerHTML = "<span style='color:red'>에러: " + err.message + "</span>";
            }
        }

        loadPDF();
    </script>
</body>
</html>
