<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no">
<title>PDF Swipe Viewer</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<style>
/* ===== 기본 레이아웃 ===== */
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  background: #ffffff;
  overscroll-behavior: none;
}

#wrap {
  position: relative;
  width: 100%;
  height: 100%;
}

/* ===== PDF 캔버스 ===== */
canvas {
  display: block;
  margin: auto;
  pointer-events: none; /* 스와이프는 wrap에서 */
}

/* ===== 슬라이드 효과 레이어 ===== */
#slideEffect {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #ffffff;
  transform: translateX(0);
  opacity: 0;
  pointer-events: none;
  z-index: 10;
}
</style>
</head>

<body>

<div id="wrap">
  <canvas id="pdf"></canvas>
</div>

<div id="slideEffect"></div>

<script>
/* =========================
   설정
   ========================= */
const PDF_URL = 'https://52241118.github.io/PDF_Test/a.pdf';

let pdfDoc = null;
let pageNum = 1;

const wrap   = document.getElementById('wrap');
const canvas = document.getElementById('pdf');
const ctx    = canvas.getContext('2d');
const effect = document.getElementById('slideEffect');

pdfjsLib.GlobalWorkerOptions.workerSrc =
  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

/* =========================
   PDF 로드
   ========================= */
pdfjsLib.getDocument(PDF_URL).promise.then(pdf => {
  pdfDoc = pdf;
  renderPage();
});

/* =========================
   PDF 렌더 (안 잘림 + 흰 배경)
   ========================= */
function renderPage() {
  if (!pdfDoc) return;

  pdfDoc.getPage(pageNum).then(page => {

    const dpr = window.devicePixelRatio || 1;
    const base = page.getViewport({ scale: 1 });

    const effectiveHeight = window.innerHeight * 0.85;
    const scale = Math.min(
      window.innerWidth / base.width,
      effectiveHeight / base.height
    );

    const viewport = page.getViewport({ scale });

    canvas.width  = Math.floor(viewport.width * dpr);
    canvas.height = Math.floor(viewport.height * dpr);
    canvas.style.width  = viewport.width + 'px';
    canvas.style.height = viewport.height + 'px';

    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    page.render({
      canvasContext: ctx,
      viewport: viewport
    });
  });
}

/* =========================
   슬라이드 효과
   ========================= */
function slideEffect(direction) {
  effect.style.transition = 'none';
  effect.style.opacity = '0.25';

  effect.style.transform =
    direction === 'left'
      ? 'translateX(100%)'
      : 'translateX(-100%)';

  effect.offsetHeight; // reflow

  effect.style.transition =
    'transform 0.25s ease-out, opacity 0.25s ease-out';
  effect.style.transform = 'translateX(0)';
  effect.style.opacity = '0';

  setTimeout(() => {
    effect.style.transition = 'none';
    effect.style.opacity = '0';
  }, 260);
}

/* =========================
   페이지 이동
   ========================= */
function nextPage() {
  if (pageNum < pdfDoc.numPages) {
    slideEffect('left');
    pageNum++;
    renderPage();
  }
}

function prevPage() {
  if (pageNum > 1) {
    slideEffect('right');
    pageNum--;
    renderPage();
  }
}

/* =========================
   스와이프 (Pointer Events)
   ========================= */
let startX = 0;
let startY = 0;

wrap.addEventListener('pointerdown', e => {
  startX = e.clientX;
  startY = e.clientY;
});

wrap.addEventListener('pointerup', e => {
  const dx = e.clientX - startX;
  const dy = e.clientY - startY;

  if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 50) {
    dx < 0 ? nextPage() : prevPage();
  }
});

/* =========================
   회전 / 주소창 변화 대응
   ========================= */
window.addEventListener('resize', renderPage);
window.visualViewport &&
  window.visualViewport.addEventListener('resize', renderPage);
</script>

</body>
</html>
