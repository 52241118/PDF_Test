<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>PDF Viewer</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://unpkg.com/page-flip/dist/js/page-flip.browser.js"></script>
    
    <style>
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            /* 1. 배경 흰색으로 변경 */
            background-color: #ffffff; 
        }
        
        #book {
            margin: 0 auto;
            height: 100vh;
        }

        #loader {
            position: absolute;
            top: 50%; left: 0; right: 0;
            transform: translateY(-50%);
            text-align: center;
            color: #333; /* 배경이 흰색이라 글자는 검은색으로 */
            font-size: 1.2rem;
            z-index: 100;
        }

        /* 2. 페이지 번호 스타일 추가 */
        #page-count {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            color: #555;
            font-size: 14px;
            font-family: sans-serif;
            background-color: rgba(255, 255, 255, 0.8); /* 반투명 배경 */
            padding: 5px 0;
            z-index: 200;
            pointer-events: none; /* 터치 방해 안 하도록 설정 */
        }
    </style>
</head>
<body>

    <div id="loader">문서를 불러오는 중...</div>
    <div id="book"></div>
    
    <div id="page-count"></div>

    <script>
        // ==========================================
        var pdfUrl = 'a.pdf'; // 파일명 확인
        // ==========================================

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
        
        const loader = document.getElementById('loader');
        const bookElement = document.getElementById('book');
        const pageCountElement = document.getElementById('page-count');

        async function loadBook() {
            try {
                const loadingTask = pdfjsLib.getDocument(pdfUrl);
                const pdf = await loadingTask.promise;
                
                // 전체 페이지 수 저장
                const totalPages = pdf.numPages;

                // 비율 계산 로직 (기존 유지)
                const firstPage = await pdf.getPage(1);
                const viewport = firstPage.getViewport({ scale: 1 });
                const ratio = viewport.width / viewport.height;
                const screenH = window.innerHeight;
                const screenW = window.innerWidth;
                
                let bookHeight = screenH;
                let bookWidth = bookHeight * ratio;

                if (bookWidth > screenW) {
                    bookWidth = screenW;
                    bookHeight = bookWidth / ratio;
                }

                const pageFlip = new St.PageFlip(bookElement, {
                    width: bookWidth,
                    height: bookHeight,
                    size: 'fixed',
                    showCover: true,
                    usePortrait: true,
                    mobileScrollSupport: true,
                    flippingTime: 800
                });

                const pages = [];
                for (let i = 1; i <= totalPages; i++) {
                    const page = await pdf.getPage(i);
                    // 고해상도 유지 (3배)
                    const hdViewport = page.getViewport({ scale: 3.0 });

                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = hdViewport.width;
                    canvas.height = hdViewport.height;
                    canvas.style.width = '100%';
                    canvas.style.height = '100%';
                    
                    await page.render({ canvasContext: ctx, viewport: hdViewport }).promise;

                    const pageDiv = document.createElement('div');
                    pageDiv.style.display = 'flex';
                    pageDiv.style.justifyContent = 'center';
                    pageDiv.style.alignItems = 'center';
                    pageDiv.style.backgroundColor = 'white';
                    
                    // 그림자 효과 (흰 배경에서 종이 구분을 위해 약간 추가)
                    pageDiv.style.boxShadow = "0 0 5px rgba(0,0,0,0.1)"; 
                    
                    pageDiv.appendChild(canvas);
                    pages.push(pageDiv);
                }

                loader.style.display = 'none';
                pageFlip.loadFromHTML(pages);

                // 3. 페이지 번호 초기화 및 업데이트 로직
                // 초기값 설정
                pageCountElement.innerText = "1 / " + totalPages;

                // 페이지 넘길 때마다 번호 갱신
                pageFlip.on('flip', (e) => {
                    // e.data는 현재 페이지 인덱스 (0부터 시작하므로 +1)
                    const currentPage = e.data + 1;
                    pageCountElement.innerText = currentPage + " / " + totalPages;
                });

            } catch (err) {
                loader.innerHTML = "<span style='color:red'>에러: " + err.message + "</span>";
            }
        }

        loadBook();

    </script>
</body>
</html>
